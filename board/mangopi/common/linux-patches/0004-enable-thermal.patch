From 2ee99e89654eeceb0e865a5308b38fd640977081 Mon Sep 17 00:00:00 2001
From: vvpnet <v.v.p.net@mail.ru>
Date: Wed, 12 Feb 2025 14:31:56 +0600
Subject: [PATCH] Added a patch enabling CPU temperature. But so far,
 /sys/class/thermal/ is still empty.

---
 .../linux-patches/0004-enable-thermal.patch   | 34 +++++++++++++++++++
 1 file changed, 34 insertions(+)
 create mode 100644 board/mangopi/common/linux-patches/0004-enable-thermal.patch

diff --git a/board/mangopi/common/linux-patches/0004-enable-thermal.patch b/board/mangopi/common/linux-patches/0004-enable-thermal.patch
new file mode 100644
index 00000000..3b3dbf2a
--- /dev/null
+++ b/board/mangopi/common/linux-patches/0004-enable-thermal.patch
@@ -0,0 +1,34 @@
+diff --git a/arch/riscv/boot/dts/allwinner/sunxi-d1s-t113.dtsi b/arch/riscv/boot/dts/allwinner/sunxi-d1s-t113.dtsi
+index 2c26cb8b2b07..0a405ed42348 100644
+--- a/arch/riscv/boot/dts/allwinner/sunxi-d1s-t113.dtsi
++++ b/arch/riscv/boot/dts/allwinner/sunxi-d1s-t113.dtsi
+@@ -178,6 +178,18 @@ gpadc: adc@2009000 {
+ 			#io-channel-cells = <1>;
+ 		};
+ 
++		ths: thermal-sensor@2009400 {
++			compatible = "allwinner,sun20i-d1-ths";
++			reg = <0x02009400 0x400>;
++			interrupts = <SOC_PERIPHERAL_IRQ(58) IRQ_TYPE_LEVEL_HIGH>;
++			clocks = <&ccu CLK_BUS_THS>;
++			clock-names = "bus";
++			resets = <&ccu RST_BUS_THS>;
++			nvmem-cells = <&ths_calibration>;
++			nvmem-cell-names = "calibration";
++			#thermal-sensor-cells = <0>;
++		};
++
+ 		dmic: dmic@2031000 {
+ 			compatible = "allwinner,sun20i-d1-dmic",
+ 				     "allwinner,sun50i-h6-dmic";
+@@ -438,6 +450,10 @@ sid: efuse@3006000 {
+ 			reg = <0x3006000 0x1000>;
+ 			#address-cells = <1>;
+ 			#size-cells = <1>;
++
++			ths_calibration: thermal-sensor-calibration@14 {
++				reg = <0x14 0x4>;
++			};
+ 		};
+ 
+ 		crypto: crypto@3040000 {
-- 
2.43.0

